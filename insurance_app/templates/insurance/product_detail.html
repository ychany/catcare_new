{% extends 'common_app/base.html' %}
{% load static %}
{% load insurance_tags %}

{% block title %}보험 상품 상세 - 냐옹노트{% endblock %}

{% block content %}
<style>
.detail-header {
    background: var(--bg-primary);
    border-bottom: 1px solid var(--border-light);
    padding: var(--spacing-lg) var(--spacing-xl);
}
.detail-title {
    font-size: 24px;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0;
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}
.detail-main {
    max-width: 1200px;
    margin: 0 auto;
    padding: var(--spacing-xl);
}
.detail-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: var(--spacing-xl);
}
.card.detail-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    overflow: hidden;
    transition: all 0.2s;
    display: flex;
    flex-direction: column;
}
.card-header {
    background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
    color: #fff;
    padding: var(--spacing-lg) var(--spacing-xl);
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}
.card-title {
    font-size: 20px;
    font-weight: 600;
    margin: 0;
    color: #fff;
}
.card-body {
    padding: var(--spacing-xl);
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
}
.card-section {
    margin-bottom: var(--spacing-lg);
}
.card-section h5, .card-section h4 {
    font-size: 16px;
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 8px;
}
.card-section ul, .card-section table {
    margin-bottom: 0;
}
.card-section li, .card-section td {
    font-size: 15px;
    color: var(--text-secondary);
    line-height: 1.7;
    margin-bottom: 4px;
}
.card-section ul {
    padding-left: 18px;
    margin-bottom: 0;
}
.card-section ul ul {
    margin-top: 4px;
    margin-bottom: 4px;
}
.card-section table {
    margin-bottom: 12px;
}
.card-section td, .card-section th {
    vertical-align: top;
    padding: 8px 12px;
}
.card-section th {
    background: var(--bg-tertiary);
    color: var(--primary-color);
    font-weight: 600;
    font-size: 15px;
}
.card-footer {
    padding: var(--spacing-md) var(--spacing-xl);
    background: var(--bg-tertiary);
    border-radius: 0 0 var(--radius-lg) var(--radius-lg);
}
.info-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    margin-bottom: var(--spacing-xl);
}
.info-header {
    background: var(--bg-tertiary);
    padding: var(--spacing-lg);
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}
.info-title {
    font-size: 17px;
    font-weight: 600;
    margin: 0;
    color: var(--primary-color);
}
.info-body {
    padding: var(--spacing-xl);
}
.btn-back {
    background: var(--primary-color);
    color: #fff;
    border: none;
    border-radius: var(--radius-lg);
    font-size: 15px;
    font-weight: 500;
    padding: 10px 24px;
    text-decoration: none;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    width: 100%;
    justify-content: center;
}
.btn-back:hover {
    background: var(--primary-color-dark);
    color: #fff;
}
@media (max-width: 1024px) {
    .detail-grid { grid-template-columns: 1fr; }
}
@media (max-width: 768px) {
    .detail-title { font-size: 20px; }
    .detail-main { padding: var(--spacing-lg); }
    .card-body { padding: var(--spacing-lg); }
}
</style>

<div class="detail-header">
  <div class="detail-title">
    <i class="fas fa-shield-alt"></i>
    보험 상품 상세
  </div>
</div>

<div class="detail-main">
  <div class="detail-grid">
    <div>
      <div class="card detail-card">
        <div class="card-header">
          <div class="card-title">{{ product.name }}</div>
        </div>
        <div class="card-body">
          <div class="card-section">
            <h5>보험사</h5>
            <div style="font-size:15px; color:var(--text-secondary); margin-bottom:8px;">{{ product.company.name }}</div>
          </div>
          <div class="card-section">
            <h5>보장 내용</h5>
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>보장 항목</th>
                  <th>보장 내용</th>
                </tr>
              </thead>
              <tbody>
                {% for key, value in coverage_details_verbose.items %}
                  {% if key != '기본보장' %}
                  <tr>
                    <td>{{ key }}</td>
                    <td>
                      {% if value %}
                        {% for v in value %}{{ v }}{% if not forloop.last %}, {% endif %}{% endfor %}
                      {% else %}-{% endif %}
                    </td>
                  </tr>
                  {% endif %}
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div class="card-section">
            <h5>카테고리별 보장 내용</h5>
            <ul>
              {% for category, details in category_coverage_summary.items %}
                <li><b>{{ category }}</b>: 
                  <ul style="margin-bottom:0;">
                    {% for detail in details %}
                      <li>{{ detail }}</li>
                    {% endfor %}
                  </ul>
                </li>
              {% endfor %}
            </ul>
          </div>
          <div class="card-section">
            <h5>특별 혜택</h5>
            <ul>
              {% for benefit in special_benefits_verbose %}
                <li>{{ benefit }}</li>
              {% empty %}
                <li class="text-muted">특별 혜택이 없습니다.</li>
              {% endfor %}
            </ul>
          </div>
          <div class="card-section">
            <h5>기본 정보</h5>
            <div style="font-size:15px; color:var(--text-secondary);">
              <div><strong>월 보험료:</strong> {{ product.base_price|floatformat:0 }}원</div>
              <div><strong>보장기간:</strong> {{ product.coverage_period }}년</div>
              <div><strong>적용 연령:</strong> {{ product.min_age }}세 - {{ product.max_age }}세</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div>
      <div class="info-card">
        <div class="info-header">
          <div class="info-title">보험사 정보</div>
        </div>
        <div class="info-body">
          <div style="font-size:15px; color:var(--text-secondary); margin-bottom:8px;"><strong>보험사 평점:</strong> {{ product.company.rating }}/5.0</div>
          <div style="font-size:15px; color:var(--text-secondary); margin-bottom:8px;"><strong>웹사이트:</strong> <a href="{{ product.company.website }}" target="_blank">{{ product.company.website }}</a></div>
          <hr>
          <a href="{% url 'insurance:main' %}" class="btn-back"><i class="fas fa-arrow-left"></i> 목록으로 돌아가기</a>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} 