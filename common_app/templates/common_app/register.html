{% extends 'common_app/base.html' %}

{% block title %}íšŒì›ê°€ì… - ê³ ì–‘ì´ ì •ë³´ ì‚¬ì´íŠ¸{% endblock %}
{% block top_bar %}{% endblock %}
{% block sidebar %}{% endblock %}

{% block content %}
<style>
.register-full-bg {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    width: 100vw;
    height: auto;
    min-height: 100vh;
    background: #fff;
    z-index: 9999;
    display: block;
    padding: 40px 20px;
    overflow-y: scroll;
}
.register-card {
    max-width: 800px;
    width: 100%;
    border-radius: 18px;
    margin: 0 auto;
}
@media (max-width: 900px) {
    .register-card { max-width: 98vw; }
}
</style>
<div class="register-full-bg">
    <div class="card shadow-lg register-card">
        <div class="card-body p-4">
            <div class="text-center mb-4">
                <span style="font-size:2.5rem;">ğŸ±</span>
                <h2 class="fw-bold mt-2 mb-1" style="letter-spacing:2px; color:#172852;">íšŒì›ê°€ì…</h2>
                <div class="text-muted mb-2" style="font-size:1.1rem;">ê¸°ë³¸ ì •ë³´ì™€ ê³ ì–‘ì´ ì •ë³´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”!</div>
            </div>
            <form method="post" enctype="multipart/form-data" id="registerForm">
                {% csrf_token %}
                <div class="row g-4">
                  <div class="col-md-6">
                    <h5 class="mb-3">ì‚¬ìš©ì ì •ë³´</h5>
                    {{ user_form.as_p }}
                  </div>
                  <div class="col-md-6">
                    <h5 class="mb-3">ê³ ì–‘ì´ ì •ë³´</h5>
                    <div id="pet-forms"></div>
                    <button type="button" class="btn btn-outline-secondary mb-3 w-100" id="add-pet-btn">+ ê³ ì–‘ì´ ì¶”ê°€</button>
                  </div>
                </div>
                <button type="submit" class="btn btn-primary w-100 py-2 fw-bold mt-3" style="font-size:1.1rem;">ê°€ì…í•˜ê¸°</button>
            </form>
            <!-- Hidden breed template -->
            <div id="breed-template" style="display:none;">
                <div class="mb-3">
                    <label class="form-label" for="{{ pet_form.breed.id_for_label }}">{{ pet_form.breed.label }}</label>
                    {{ pet_form.breed }}
                    {% for error in pet_form.breed.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
<script>
// DOMContentLoaded ì´í›„ ì‹¤í–‰
document.addEventListener('DOMContentLoaded', function() {
    const breedTemplateHTML = document.getElementById('breed-template').innerHTML;
    const petFormsDiv = document.getElementById('pet-forms');
    const addPetBtn = document.getElementById('add-pet-btn');
    let petIdx = 0;

    // ê³ ì–‘ì´ í¼ ìƒì„± í•¨ìˆ˜
    function createPetForm(idx) {
        const html = breedTemplateHTML
            .replace(/name="breed"/, `name="pet_breed_${idx}"`)
            .replace(/id="id_breed"/, `id="pet_breed_${idx}"`)
            .replace(/for="id_breed"/, `for="pet_breed_${idx}"`);
        return `
        <div class="card mb-3 pet-form" data-idx="${idx}">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h6 class="mb-0">ê³ ì–‘ì´ #${idx+1}</h6>
              <button type="button" class="btn btn-danger btn-sm remove-pet-btn">ì‚­ì œ</button>
            </div>
            <div class="mb-2">
              <label class="form-label">ì´ë¦„</label>
              <input type="text" name="pet_name_${idx}" class="form-control" required>
            </div>
            ${html}
            <div class="mb-2">
              <label class="form-label">ìƒë…„ì›”ì¼</label>
              <input type="date" name="pet_birth_date_${idx}" class="form-control" required>
            </div>
            <div class="mb-2">
              <label class="form-label">ì„±ë³„</label>
              <select name="pet_gender_${idx}" class="form-select" required>
                <option value="male">ìˆ˜ì»·</option>
                <option value="female">ì•”ì»·</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label">ì¤‘ì„±í™” ì—¬ë¶€</label>
              <select name="pet_neutered_${idx}" class="form-select" required>
                <option value="True">ì˜ˆ</option>
                <option value="False">ì•„ë‹ˆì˜¤</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label">ì²´ì¤‘(kg)</label>
              <input type="number" step="0.01" name="pet_weight_${idx}" class="form-control">
            </div>
            <div class="mb-2">
              <label class="form-label">íŠ¹ì´ì‚¬í•­</label>
              <input type="text" name="pet_notes_${idx}" class="form-control">
            </div>
            <div class="mb-2">
              <label class="form-label">ì‚¬ì§„</label>
              <input type="file" name="pet_image_${idx}" class="form-control">
            </div>
          </div>
        </div>`;
    }

    // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ìœ„ì„
    petFormsDiv.addEventListener('click', function(e) {
        if (e.target.classList.contains('remove-pet-btn')) {
            e.target.closest('.pet-form').remove();
        }
    });

    // ìµœì´ˆ 1ê°œ í¼ ìƒì„±
    petFormsDiv.insertAdjacentHTML('beforeend', createPetForm(petIdx));
    petIdx++;

    // ê³ ì–‘ì´ ì¶”ê°€ ë²„íŠ¼ ì´ë²¤íŠ¸
    addPetBtn.addEventListener('click', function() {
        petFormsDiv.insertAdjacentHTML('beforeend', createPetForm(petIdx));
        petIdx++;
    });
});
</script>
{% endblock %} 